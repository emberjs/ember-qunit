{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["/* globals Testem */\nimport { macroCondition, getOwnConfig, importSync } from '@embroider/macros';\nimport { setTesting } from '@ember/debug';\nimport { setAdapter } from 'ember-testing/lib/test/adapter';\n\n/**\n * Load qunit-default theme by default, if no custom theme is specified.\n */\nif (\n  macroCondition(\n    getOwnConfig()?.theme === undefined ||\n      getOwnConfig()?.theme === 'qunit-default' ||\n      getOwnConfig()?.theme === 'ember'\n  )\n) {\n  importSync('qunit/qunit/qunit.css');\n}\n\nif (macroCondition(!getOwnConfig()?.disableContainerStyles)) {\n  importSync('./test-container-styles.css');\n}\n\nif (macroCondition(getOwnConfig()?.theme === 'ember')) {\n  importSync('qunit-theme-ember/qunit.css');\n}\n\nexport { default as QUnitAdapter, nonTestDoneCallback } from './adapter';\n\nimport './qunit-configuration';\n\nif (typeof Testem !== 'undefined') {\n  Testem.hookIntoTestFramework();\n}\n\nimport { _backburner } from '@ember/runloop';\nimport { resetOnerror, getTestMetadata } from '@ember/test-helpers';\nimport * as QUnit from 'qunit';\nimport QUnitAdapter from './adapter';\nimport {\n  setupContext,\n  teardownContext,\n  setupRenderingContext,\n  setupApplicationContext,\n  validateErrorHandler,\n} from '@ember/test-helpers';\nimport { installTestNotIsolatedHook } from './test-isolation-validation';\n\nlet waitForSettled = true;\n\nexport function setupTest(hooks, _options) {\n  let options = { waitForSettled, ..._options };\n\n  hooks.beforeEach(function (assert) {\n    let testMetadata = getTestMetadata(this);\n    testMetadata.framework = 'qunit';\n\n    return setupContext(this, options).then(() => {\n      let originalPauseTest = this.pauseTest;\n      this.pauseTest = function QUnit_pauseTest() {\n        assert.timeout(-1); // prevent the test from timing out\n        return originalPauseTest.call(this);\n      };\n    });\n  });\n\n  hooks.afterEach(function () {\n    return teardownContext(this, options);\n  });\n}\n\nexport function setupRenderingTest(hooks, _options) {\n  let options = { waitForSettled, ..._options };\n\n  setupTest(hooks, options);\n\n  hooks.beforeEach(function () {\n    return setupRenderingContext(this);\n  });\n}\n\nexport function setupApplicationTest(hooks, _options) {\n  let options = { waitForSettled, ..._options };\n\n  setupTest(hooks, options);\n\n  hooks.beforeEach(function () {\n    return setupApplicationContext(this);\n  });\n}\n\n/**\n   Uses current URL configuration to setup the test container.\n\n   * If `?nocontainer` is set, the test container will be hidden.\n   * If `?devmode` or `?fullscreencontainer` is set, the test container will be\n     made full screen.\n\n   @method setupTestContainer\n */\nexport function setupTestContainer() {\n  let testContainer = document.getElementById('ember-testing-container');\n  if (!testContainer) {\n    return;\n  }\n\n  let params = QUnit.urlParams;\n\n  if (params.devmode || params.fullscreencontainer) {\n    testContainer.classList.add('ember-testing-container-full-screen');\n  }\n\n  if (params.nocontainer) {\n    testContainer.classList.add('ember-testing-container-hidden');\n  }\n}\n\n/**\n   Instruct QUnit to start the tests.\n   @method startTests\n */\nexport function startTests() {\n  QUnit.start();\n}\n\n/**\n   Sets up the `Ember.Test` adapter for usage with QUnit 2.x.\n\n   @method setupTestAdapter\n */\nexport function setupTestAdapter() {\n  setAdapter(QUnitAdapter.create());\n}\n\n/**\n  Ensures that `Ember.testing` is set to `true` before each test begins\n  (including `before` / `beforeEach`), and reset to `false` after each test is\n  completed. This is done via `QUnit.testStart` and `QUnit.testDone`.\n\n */\nexport function setupEmberTesting() {\n  QUnit.testStart(() => {\n    setTesting(true);\n  });\n\n  QUnit.testDone(() => {\n    setTesting(false);\n  });\n}\n\n/**\n  Ensures that `Ember.onerror` (if present) is properly configured to re-throw\n  errors that occur while `Ember.testing` is `true`.\n*/\nexport function setupEmberOnerrorValidation() {\n  QUnit.module('ember-qunit: Ember.onerror validation', function () {\n    QUnit.test('Ember.onerror is functioning properly', function (assert) {\n      assert.expect(1);\n      let result = validateErrorHandler();\n      assert.ok(\n        result.isValid,\n        `Ember.onerror handler with invalid testing behavior detected. An Ember.onerror handler _must_ rethrow exceptions when \\`Ember.testing\\` is \\`true\\` or the test suite is unreliable. See https://git.io/vbine for more details.`\n      );\n    });\n  });\n}\n\nexport function setupResetOnerror() {\n  QUnit.testDone(resetOnerror);\n}\n\nexport function setupTestIsolationValidation(delay) {\n  waitForSettled = false;\n  _backburner.DEBUG = true;\n  QUnit.on('testStart', () => installTestNotIsolatedHook(delay));\n}\n\n/**\n   @method start\n   @param {Object} [options] Options to be used for enabling/disabling behaviors\n   @param {Boolean} [options.setupTestContainer] If `false` the test container will not\n   be setup based on `devmode`, `dockcontainer`, or `nocontainer` URL params.\n   @param {Boolean} [options.startTests] If `false` tests will not be automatically started\n   (you must run `QUnit.start()` to kick them off).\n   @param {Boolean} [options.setupTestAdapter] If `false` the default Ember.Test adapter will\n   not be updated.\n   @param {Boolean} [options.setupEmberTesting] `false` opts out of the\n   default behavior of setting `Ember.testing` to `true` before all tests and\n   back to `false` after each test will.\n   @param {Boolean} [options.setupTestIsolationValidation] If `false` test isolation validation\n   will be disabled.\n   @param {Number} [options.testIsolationValidationDelay] When using\n   setupTestIsolationValidation this number represents the maximum amount of\n   time in milliseconds that is allowed _after_ the test is completed for all\n   async to have been completed. The default value is 50.\n */\nexport function start(options = {}) {\n  if (options.setupTestContainer !== false) {\n    setupTestContainer();\n  }\n\n  if (options.setupTestAdapter !== false) {\n    setupTestAdapter();\n  }\n\n  if (options.setupEmberTesting !== false) {\n    setupEmberTesting();\n  }\n\n  if (\n    typeof options.setupTestIsolationValidation !== 'undefined' &&\n    options.setupTestIsolationValidation !== false\n  ) {\n    setupTestIsolationValidation(options.testIsolationValidationDelay);\n  }\n\n  if (options.startTests !== false) {\n    startTests();\n  }\n\n  setupResetOnerror();\n}\n"],"names":["macroCondition","getOwnConfig","theme","undefined","importSync","disableContainerStyles","Testem","hookIntoTestFramework","waitForSettled","setupTest","hooks","_options","options","beforeEach","assert","testMetadata","getTestMetadata","framework","setupContext","then","originalPauseTest","pauseTest","QUnit_pauseTest","timeout","call","afterEach","teardownContext","setupRenderingTest","setupRenderingContext","setupApplicationTest","setupApplicationContext","setupTestContainer","testContainer","document","getElementById","params","QUnit","urlParams","devmode","fullscreencontainer","classList","add","nocontainer","startTests","start","setupTestAdapter","setAdapter","QUnitAdapter","create","setupEmberTesting","testStart","setTesting","testDone","setupEmberOnerrorValidation","module","test","expect","result","validateErrorHandler","ok","isValid","setupResetOnerror","resetOnerror","setupTestIsolationValidation","delay","_backburner","DEBUG","on","installTestNotIsolatedHook","testIsolationValidationDelay"],"mappings":"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"}