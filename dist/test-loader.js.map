{"version":3,"file":"test-loader.js","sources":["../src/test-loader.js"],"sourcesContent":["/* globals requirejs, require */\n\nimport * as QUnit from 'qunit';\n\nexport class TestLoader {\n  static load() {\n    new TestLoader().loadModules();\n  }\n\n  constructor() {\n    this._didLogMissingUnsee = false;\n  }\n\n  shouldLoadModule(moduleName) {\n    return moduleName.match(/[-_]test$/);\n  }\n\n  listModules() {\n    return Object.keys(requirejs.entries);\n  }\n\n  listTestModules() {\n    let moduleNames = this.listModules();\n    let testModules = [];\n    let moduleName;\n\n    for (let i = 0; i < moduleNames.length; i++) {\n      moduleName = moduleNames[i];\n\n      if (this.shouldLoadModule(moduleName)) {\n        testModules.push(moduleName);\n      }\n    }\n\n    return testModules;\n  }\n\n  loadModules() {\n    let testModules = this.listTestModules();\n    let testModule;\n\n    for (let i = 0; i < testModules.length; i++) {\n      testModule = testModules[i];\n      this.require(testModule);\n      this.unsee(testModule);\n    }\n  }\n\n  require(moduleName) {\n    try {\n      require(moduleName);\n    } catch (e) {\n      this.moduleLoadFailure(moduleName, e);\n    }\n  }\n\n  unsee(moduleName) {\n    if (typeof require.unsee === 'function') {\n      require.unsee(moduleName);\n    } else if (!this._didLogMissingUnsee) {\n      this._didLogMissingUnsee = true;\n      if (typeof console !== 'undefined') {\n        console.warn(\n          'unable to require.unsee, please upgrade loader.js to >= v3.3.0'\n        );\n      }\n    }\n  }\n\n  moduleLoadFailure(moduleName, error) {\n    moduleLoadFailures.push(error);\n\n    QUnit.module('TestLoader Failures');\n    QUnit.test(moduleName + ': could not be loaded', function () {\n      throw error;\n    });\n  }\n}\n\nlet moduleLoadFailures = [];\n\nQUnit.done(function () {\n  let length = moduleLoadFailures.length;\n\n  try {\n    if (length === 0) {\n      // do nothing\n    } else if (length === 1) {\n      throw moduleLoadFailures[0];\n    } else {\n      throw new Error('\\n' + moduleLoadFailures.join('\\n'));\n    }\n  } finally {\n    // ensure we release previously captured errors.\n    moduleLoadFailures = [];\n  }\n});\n\n/**\n   Load tests following the default patterns:\n\n   * The module name ends with `-test`\n\n   @method loadTests\n */\nexport function loadTests() {\n  new TestLoader().loadModules();\n}\n"],"names":["TestLoader","load","loadModules","constructor","_didLogMissingUnsee","shouldLoadModule","moduleName","match","listModules","Object","keys","requirejs","entries","listTestModules","moduleNames","testModules","i","length","push","testModule","require","unsee","e","moduleLoadFailure","console","warn","error","moduleLoadFailures","QUnit","module","test","done","Error","join","loadTests"],"mappings":"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"}